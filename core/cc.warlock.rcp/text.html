<!DOCTYPE html>
<html>
<head>
  <title>Text Window</title>
  <script src="jquery-2.0.2.min.js"></script>
  <script>
    var atBottom = true;
    $(document).ready(function () {
        $(window).resize(function() {
            if(atBottom)
              window.scroll(0, document.body.scrollHeight);
        });
        $(window).scroll(function() {
            atBottom = $(window).height() + $(window).scrollTop() >= $(document).height();
        });
        window.onerror = function myErrorHandler(errorMsg, url, lineNumber) {
          window.status = "error:"+lineNumber+":"+errorMsg;
          return false;
        }
    });
    function autoscroll() {
      if(atBottom && $(window).height() + $(window).scrollTop() < $(document).height())
        window.scroll(0, document.body.scrollHeight);
    }
    function append(str) {
      var top = document.getElementById('text');
      top.innerHTML += str;
      autoscroll();
    }
    function appendLine(str) {
        var main = document.getElementById('text');
        var element = document.createElement('div');
        element.className = 'line';
        element.innerHTML = str;
        main.appendChild(element);
        var bg = $(element).children('.full-line:not(:empty)').css('background-color');
        if(bg) {
        	$(element).css('background-color', bg);
        	window.status="bg is " + bg;
        }
        if(atBottom)
          window.scroll(0, document.body.scrollHeight);
      }
    function setStyle(name, property, value) {
      var rules = document.styleSheets[0].cssRules;
      var ruleExists = false;
      var myclass = '.'+name;
      for (var i = 0; i < rules.length; i++) {
        if (rules[i].selectorText == myclass) {
			rules[i].style.setProperty(property, value, null);
			ruleExists = true;
			break;
		}
      }
      if(!ruleExists) {
        var rule = myclass+" { "+property+": "+value+" }";
        document.styleSheets[0].insertRule(rule, 0);
        window.status=rule;
      }
    }
    function replaceComponent(name, value) {
      var element = document.getElementById(name);
      element.innerHTML = value;
      autoscroll();
    }
    function ignoreEmptyLines(ignoreLines) {
      var value = '0';
      if(!ignoreLines)
        value = '1em';
      var rules = document.styleSheets[0].cssRules;
      for (var i = 0; i < rules.length; i++) {
        if (rules[i].selectorText == '.line') {
			rules[i].style.setProperty('min-height', value, null);
			window.status='set height to '+value;
			break;
		}
      }
    }
  </script>
  <style>
    #text {
      white-space: pre-wrap;
    }
    .line {
      min-height: 0; // Something for ignoreEmptyLines to find
    }
  </style>
</head>
<body>
  <div id="text"></div>
  <script>$(function() { appendLine("initial text"); });</script>
  <div style="position:fixed;top:0;right:0;" onclick="window.status=document.getElementById('text').innerHTML">show debug</div>
</body>
</html>